<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù†Ø¸Ø§Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.3/xlsx.full.min.js"></script>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      direction: rtl;
      text-align: right;
      margin: 0;
      padding: 0;
      background-color: #f4f7fb;
      color: #4a4a4a;
    }
    .container {
      background: #ffffff;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      max-width: 100%;
      box-sizing: border-box;
      margin: 20px auto;
      font-size: 16px;
      border: 1px solid #dde1e7;
    }
    h2 {
      color: #2a4d6d;
      font-size: 24px;
      margin-bottom: 20px;
    }
    label {
      font-size: 18px;
      font-weight: bold;
      color: #3e4751;
    }
    select, input, button {
      margin: 10px 0;
      padding: 12px;
      font-size: 16px;
      border-radius: 8px;
      border: 1px solid #ced4da;
      outline: none;
      transition: background-color 0.3s, box-shadow 0.3s;
      background-color: #fafbfc;
    }
    select:focus, input:focus, button:focus {
      border-color: #6c8ed4;
      box-shadow: 0 0 0 0.25rem rgba(108,142,212,0.5);
    }
    .attendance-btns button {
      background-color: #6c757d;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 10px 15px;
      font-size: 16px;
      transition: background-color 0.3s, opacity 0.3s;
      cursor: pointer;
    }
    .present-btn.selected {
      background-color: #28a745;
    }
    .absent-btn.selected {
      background-color: #dc3545;
    }
    .excused-btn.selected {
      background-color: #ffc107;
    }
    .unset-btn.selected {
      background-color: white;
      color: black;
    }
    .bonus-btn {
      background-color: #e0e0e0;
      border: none;
      border-radius: 8px;
      padding: 8px 12px;
      cursor: pointer;
      font-size: 16px;
    }
    .bonus-btn.golden {
      background-color: gold;
      color: #000;
    }
    .reset-btn {
      background-color: #ffc107;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 12px;
      font-size: 16px;
      cursor: pointer;
      transition: background-color 0.3s, opacity 0.3s;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #dde1e7;
      padding: 12px;
      text-align: center;
      font-size: 16px;
      background-color: #f8f9fa;
    }
    th {
      background-color: #e8eef3;
      color: #2a4d6d;
    }
    .attendance-btns, .bonus-container {
      display: flex;
      justify-content: center;
      gap: 5px;
    }
    .selected {
      opacity: 0.9;
      font-weight: bold;
    }
    footer {
      text-align: center;
      padding: 15px;
      font-size: 14px;
      color: #888;
    }
    @media (max-width: 768px) {
      .container {
        padding: 15px;
      }
      table {
        font-size: 14px;
      }
      h2 {
        font-size: 20px;
      }
    }
  </style>
</head>
<body>
  <main class="container">
    <h2>Ù†Ø¸Ø§Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±</h2>
    <p>ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®: <span id="currentDate"></span></p>
    <label for="subject">ğŸ“š Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø©:</label>
    <select id="subject">
      <option>Advanced Cryptography</option>
      <option>Arabic</option>
      <option>Database Security</option>
      <option>Data Structures and Algorithms</option>
      <option>Internet Protocols</option>
      <option>Operating Systems</option>
      <option>Web Programming Security</option>
    </select>
    <br>
    <label for="sectionSelect">ğŸ« Ø§Ø®ØªØ± Ø§Ù„Ø´Ø¹Ø¨Ø©:</label>
    <select id="sectionSelect">
      <option value="A">A</option>
      <option value="B">B</option>
      <option value="C">C</option>
      <option value="D">D</option>
      <option value="E">E</option>
      <option value="F">F</option>
      <option value="G">G</option>
      <option value="H">H</option>
      <option value="I">I</option>
      <option value="J">J</option>
    </select>
    <p>
      ğŸ‘¥ Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„ÙŠ: <span id="totalCount">0</span> | 
      âœ… Ø§Ù„Ø­Ø¶ÙˆØ±: <span id="presentCount">0</span> | 
      âŒ Ø§Ù„ØºÙŠØ§Ø¨: <span id="absentCount">0</span> | 
      âš ï¸ Ø§Ù„Ù…Ø¬Ø§Ø²: <span id="excusedCount">0</span>
    </p>
    <table id="attendanceTable" role="table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Ø§Ù„Ø§Ø³Ù…</th>
          <th>Ø§Ù„Ø­Ø¶ÙˆØ± / Ø§Ù„ØºÙŠØ§Ø¨ / Ø§Ù„Ù…Ø¬Ø§Ø²</th>
          <th>Ø¨Ù„Ø³+</th>
        </tr>
      </thead>
      <tbody id="studentsTableBody"></tbody>
    </table>
    <button class="reset-btn" id="resetAttendanceBtn">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø·</button>
    <button id="downloadExcelBtn">ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Excel</button>
  </main>
  <footer>Ø­Ù‚ÙˆÙ‚ Ø§Ù„ØªØµÙ…ÙŠÙ… Â© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</footer>
  <script>
    // Ø¹Ø±Ø¶ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø§Ù„ÙŠ
    document.getElementById("currentDate").textContent = new Date().toLocaleDateString("ar-EG");

    // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ Ù„Ø´Ø¹Ø¨Ø© A (Ø£Ø³Ù…Ø§Ø¡ Ø´Ø¹Ø¨ÙŠØ©)
    var studentsSectionA = [
      "Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø¯Ø§ÙˆØ¯ Ø³Ù„Ù…Ø§Ù† Ø­Ù†ÙˆÙ†",
      "Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø¹Ø¯Ù†Ø§Ù† ÙƒØ§Ø¸Ù… Ø¬Ø§Ø³Ù…",
      "Ø§Ø­Ù…Ø¯ Ø¬Ø¹ÙØ± ØµØ§Ù„Ø­ Ù…Ø­Ù…ÙˆØ¯",
      "Ø§Ø­Ù…Ø¯ Ø´Ø§ÙƒØ± Ø¬Ø¹ÙØ± Ø¹Ø°ÙŠØ¨",
      "Ø§Ø­Ù…Ø¯ Ø¹Ø§Ù…Ø± Ø¬ÙˆØ§Ø¯ ÙƒØ§Ø¸Ù…",
      "Ø§Ø­Ù…Ø¯ Ø¹Ø§Ù…Ø± Ø·Ø§Ù‡Ø± Ø­Ø³ÙˆÙ†",
      "Ø§Ø­Ù…Ø¯ Ø¹Ø¨Ø§Ø³ Ø­Ø³ÙŠÙ† Ø¬Ù…Ø¹Ù‡",
      "Ø§Ø­Ù…Ø¯ Ø¹Ø¨Ø§Ø³ Ø¹ÙˆØ§Ø¯ Ø¬Ø§Ø¨Ø±",
      "Ø§Ø­Ù…Ø¯ Ø¹Ø¨Ø§Ø³ ÙƒØ§Ø¸Ù… Ø­Ù…Ø¯Ø§Ù† Ù…Ø³Ø§Ø¦ÙŠ",
      "Ø§Ø­Ù…Ø¯ Ø¹Ø¨Ø¯ Ø§Ù„Ù…Ù†Ø¹Ù… Ø¹Ø¨Ø¯ Ø§Ù„Ø­Ù…ÙŠØ¯ Ø±Ø§Ø´Ø¯",
      "Ø§Ø­Ù…Ø¯ Ø¹Ø¯ÙŠ ÙŠØ§Ø³ Ø®Ø¶ÙŠØ±",
      "Ø§Ø­Ù…Ø¯ Ø¹Ù„ÙŠ Ø¬Ù…Ø¹Ù‡ Ø¹Ù„ÙŠ",
      "Ø§Ø­Ù…Ø¯ Ø¹Ù„ÙŠ Ø´Ø°Ø± Ø²Ø§ÙŠØ¯",
      "Ø§Ø­Ù…Ø¯ ÙØ±Ø§Ø³ Ø®Ø¶ÙŠØ± Ø­Ø³ÙŠÙ†",
      "Ø§Ø­Ù…Ø¯ ÙØ±Ø­Ø§Ù† Ø®Ù„Ù Ù‡ÙˆÙŠØ¯ÙŠ",
      "Ø§Ø­Ù…Ø¯ Ù…Ù‡Ù†Ø¯ Ø§Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯",
      "Ø§Ø­Ù…Ø¯ Ù…ÙˆÙÙ‚ ØµØ§Ø­Ø¨ Ø¯Ø§ÙˆØ¯",
      "Ø§Ø±ÙŠÙØ§Ù† ÙØ±Ù‡Ø§Ø¯ Ø·Ø§Ù‡Ø± ÙƒØ§ÙƒÙ‡ Ø®Ø§Ù†",
      "Ø§Ø³Ø§Ù…Ø© Ø­Ø³Ù† Ø¶Ø§Ø±ÙŠ Ø§Ù†ØºÙŠÙ…Ø´",
      "Ø§Ø³Ø§Ù…Ù‡ Ù†Ù‡Ø§Ø¯ Ù…Ø­Ø³Ù† Ø§Ø­Ù…Ø¯",
      "Ø§Ù„Ø£Ù…ÙŠØ± Ø¹Ù„ÙŠ Ù…Ø­ÙŠØ³Ù† Ø®Ù„Ù",
      "Ø§Ù„Ø­Ø³Ù† ÙØ§Ø¶Ù„ Ø­Ø³ÙŠÙ† Ø³Ø±Ø­Ø§Ù†",
      "Ø§Ù„Ø­Ù…Ø²Ù‡ Ù‚Ø§Ø³Ù… Ø¹Ù„ÙŠ ØµØ­Ù†",
      "Ø§Ù„Ù…Ø±ØªØ¶Ù‰ Ù…Ø§Ù„Ùƒ Ù…Ø­Ø³Ù† Ø¹Ø¨Ø¯ Ø§Ù„Ø³Ø§Ø¯Ø©",
      "Ø§Ù…Ù†Ù‡ Ø¹Ø¨Ø¯ Ø§Ù„ØµÙ…Ø¯ Ø°Ù†ÙˆÙ† Ø§Ø­Ù…Ø¯",
      "Ø§Ù…Ù†Ù‡ Ø¹Ø¨Ø¯ Ø§Ù„ØµÙ…Ø¯ Ø°Ù†ÙˆÙ† Ø§Ø­Ù…Ø¯",
      "Ø§Ù…ÙŠØ± Ø­Ø³Ù†ÙŠÙ† Ù‡Ø§Ø´Ù… Ù…Ø­Ù…Ø¯",
      "Ø§Ù…ÙŠØ± Ø¹Ø¨Ø¯ Ø§Ù„Ø±Ø­Ù…Ù† Ù…Ø²Ø¹Ù„ Ø­Ø³ÙŠÙ†",
      "Ø§Ù…ÙŠØ± Ù‚Ø§Ø³Ù… Ø³ÙˆØ§Ø¯ÙŠ Ù…Ø­Ù…Ø¯",
      "Ø§Ù…ÙŠÙ…Ø© Ø³Ø¹Ø¯ Ø¹Ø¨Ø¯ Ø§Ù„Ù…Ø·Ù„Ø¨ Ø®Ù„Ù",
      "Ø§ÙˆØ§Ø¨ Ø­Ù…Ø²Ø© Ø¹Ø¨Ø§Ø³",
      "Ø§ÙˆØ³ Ù…Ø­Ù…Ø¯ Ø­Ù…ÙŠØ¯ Ø§Ø­Ù…Ø¯",
      "Ø¨Ø§Ø±Ù‚ Ø±Ø¹Ø¯ ÙØ§Ø¶Ù„ Ø­Ø³ÙŠÙ†",
      "Ø¬Ø§Ø³Ù… Ù…Ø­Ù…Ø¯ Ø­Ø³ÙŠÙ† Ø´ÙŠØ§Ù„",
      "Ø­Ø³Ù† Ø¹Ø¨Ø§Ø³ Ø¹Ù„ÙŠ Ø­Ø³ÙŠÙ†",
      "Ø­Ø³ÙŠÙ† ÙØªØ­ Ø§Ù„Ù„Ù‡ Ø­Ø³Ø¨ Ø§Ù„Ù„Ù‡ Ø­Ù…ÙˆØ¯",
      "Ø±Ø³ÙˆÙ„ ØµÙ…ÙŠÙ… ÙƒØ±ÙŠØ¯ÙŠ Ø¹Ù†ÙÙˆØµ",
      "Ø±ÙˆØ§Ù† Ø¹Ù„ÙŠ Ø¹Ø§Ø¯Ù„ Ø¹Ø¨Ø¯ Ø§Ù„ÙˆÙ‡Ø§Ø¨",
      "Ø²Ù‡Ø±Ø§Ø¡ Ù…Ø­Ù…Ø¯ Ø¨Ø¯Ø± Ø¬Ø¯ÙˆØ¹",
      "Ø²ÙŠÙ† Ø§Ù„Ø¹Ø§Ø¨Ø¯ÙŠÙ† Ø¹Ù„Ø§ÙˆÙŠ Ø¹Ø¨Ø¯ Ø§Ù„Ø­Ø³ÙŠÙ†",
      "Ø³Ø¨Ø£ ÙˆÙ„ÙŠØ¯ Ù…Ø­Ù…Ø¯ Ù…Ø³Ø§Ø¦ÙŠ",
      "Ø³Ø¬Ù‰ Ù…Ø­Ù…Ø¯ Ø­Ù…ÙŠØ¯ Ø¹Ø¨Ø§Ø³ Ù…Ø³Ø§Ø¦ÙŠ",
      "Ø¶Ø­Ù‰ Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ø­Ø³Ù† Ø¹Ù„ÙŠ",
      "Ø¹Ø¨Ø§Ø³ ÙˆÙ„ÙŠØ¯ Ø®Ø§Ù„Ø¯ Ù†Ø´Ø¹Ø§Ù†",
      "Ù‚ØªØ§Ø¯Ø© Ø´Ø§ÙƒØ± Ø¬Ø¹ÙØ± Ø¹Ø°ÙŠØ¨",
      "Ù…Ø­Ù…Ø¯ Ø¬ÙˆØ§Ø¯ Ø±Ø´ÙŠØ¯ ÙŠØ§Ø³Ø± ÙƒØ²Ø§Ø±",
      "Ù…Ø­Ù…Ø¯ Ø­Ø³Ø§Ù… Ù…Ø­Ù…Ø¯ Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡",
      "Ù…Ø­Ù…Ø¯ Ù‡Ø§Ø´Ù… Ù…Ø­Ù…Ø¯ Ø´Ù…Ø³ Ø§Ù„Ø¯ÙŠÙ†",
      "Ù…Ø±ØªØ¶Ù‰ Ø±ÙŠØ§Ø¶ Ø­Ø³Ù† Ø¹Ù„ÙˆØ§Ù† Ù…Ø³Ø§Ø¦ÙŠ",
      "Ù…ØµØ·ÙÙ‰ ØµÙ„Ø§Ø­ Ø§Ù„Ø¯ÙŠÙ† Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø¬Ø§Ø³Ù…",
      "Ù…ÙŠØ³ ÙˆØ³Ø§Ù… Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ù…Ù‡Ø¯ÙŠ",
      "ÙŠØ§Ø³Ø± Ø¹Ù…Ø§Ø± Ø¨Ø¯Ø±ÙŠ ØµØ¨Ø±ÙŠ",
      "ÙŠØ§Ø³ÙŠÙ† Ø­ÙŠØ¯Ø± Ø­Ù…Ø²Ø© Ù…Ø­Ù…Ø¯ Ø­Ø³ÙŠÙ†"
    ];
    // (ÙŠØªÙ… ØªØ¹Ø±ÙŠÙ Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø¨Ù†ÙØ³ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø©...)
    var studentsSectionB = [ /* ... */ ];
    var studentsSectionC = [ /* ... */ ];
    var studentsSectionD = [ /* ... */ ];
    var studentsSectionE = [ /* ... */ ];
    var studentsSectionF = [ /* ... */ ];
    var studentsSectionG = [ /* ... */ ];
    var studentsSectionH = [ /* ... */ ];
    var studentsSectionI = [ /* ... */ ];
    var studentsSectionJ = [ /* ... */ ];

    var sections = {
      "A": studentsSectionA,
      "B": studentsSectionB,
      "C": studentsSectionC,
      "D": studentsSectionD,
      "E": studentsSectionE,
      "F": studentsSectionF,
      "G": studentsSectionG,
      "H": studentsSectionH,
      "I": studentsSectionI,
      "J": studentsSectionJ
    };

    var currentSection = document.getElementById("sectionSelect").value;
    var students = sections[currentSection];
    var attendanceData = getAttendanceData();
    var bonusData = getBonusData();

    function getAttendanceData() {
      var key = 'attendanceData_' + currentSection;
      try {
        var data = JSON.parse(localStorage.getItem(key));
        if (Array.isArray(data) && data.length === students.length) return data;
      } catch(e){}
      return new Array(students.length).fill(null);
    }
    function setAttendanceData(data) {
      var key = 'attendanceData_' + currentSection;
      try { localStorage.setItem(key, JSON.stringify(data)); } catch(e){}
    }

    function getBonusData() {
      var key = 'bonusData_' + currentSection;
      try {
        var data = JSON.parse(localStorage.getItem(key));
        if (Array.isArray(data) && data.length === students.length) return data;
      } catch(e){}
      return new Array(students.length).fill(null);
    }
    function setBonusData(data) {
      var key = 'bonusData_' + currentSection;
      try { localStorage.setItem(key, JSON.stringify(data)); } catch(e){}
    }

    function renderTable() {
      var tableBody = document.getElementById("studentsTableBody");
      tableBody.innerHTML = "";
      students.forEach(function(student, index) {
        var row = document.createElement("tr");

        // Ø±Ù‚Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ ÙˆØ§Ù„Ø§Ø³Ù…
        var idCell = document.createElement("td");
        idCell.textContent = index + 1;
        var nameCell = document.createElement("td");
        nameCell.textContent = student;

        // Ø®Ù„ÙŠØ© Ø§Ù„Ø­Ø¶ÙˆØ±/Ø§Ù„ØºÙŠØ§Ø¨/Ø§Ù„Ù…Ø¬Ø§Ø²
        var attendanceCell = document.createElement("td");
        var btnContainer = document.createElement("div");
        btnContainer.classList.add("attendance-btns");

        // Ø²Ø± Ø§Ù„Ø­Ø¶ÙˆØ±
        var presentBtn = document.createElement("button");
        presentBtn.classList.add("present-btn");
        if (attendanceData[index] === "present") presentBtn.classList.add("selected");
        presentBtn.textContent = "âœ… Ø­Ø¶ÙˆØ±";
        presentBtn.setAttribute("data-index", index);
        presentBtn.setAttribute("data-status", "present");
        btnContainer.appendChild(presentBtn);

        // Ø²Ø± Ø§Ù„ØºÙŠØ§Ø¨
        var absentBtn = document.createElement("button");
        absentBtn.classList.add("absent-btn");
        if (attendanceData[index] === "absent") absentBtn.classList.add("selected");
        absentBtn.textContent = "âŒ ØºÙŠØ§Ø¨";
        absentBtn.setAttribute("data-index", index);
        absentBtn.setAttribute("data-status", "absent");
        btnContainer.appendChild(absentBtn);

        // Ø²Ø± Ø§Ù„Ù…Ø¬Ø§Ø²
        var excusedBtn = document.createElement("button");
        excusedBtn.classList.add("excused-btn");
        if (attendanceData[index] === "Ù…Ø¬Ø§Ø²") excusedBtn.classList.add("selected");
        excusedBtn.textContent = "âš ï¸ Ù…Ø¬Ø§Ø²";
        excusedBtn.setAttribute("data-index", index);
        excusedBtn.setAttribute("data-status", "Ù…Ø¬Ø§Ø²");
        btnContainer.appendChild(excusedBtn);

        // Ø²Ø± Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ¯
        var unsetBtn = document.createElement("button");
        unsetBtn.classList.add("unset-btn");
        if (attendanceData[index] === null) unsetBtn.classList.add("selected");
        unsetBtn.textContent = "â” Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ¯";
        unsetBtn.setAttribute("data-index", index);
        unsetBtn.setAttribute("data-status", "unset");
        btnContainer.appendChild(unsetBtn);

        attendanceCell.appendChild(btnContainer);

        // Ø®Ù„ÙŠØ© Ø§Ù„Ø¨Ù„Ø³+
        var bonusCell = document.createElement("td");
        var bonusContainer = document.createElement("div");
        bonusContainer.classList.add("bonus-container");

        var bonusBtn = document.createElement("button");
        bonusBtn.classList.add("bonus-btn");
        if (!bonusData[index]) {
          bonusBtn.textContent = "Ø¨Ù„Ø³+";
          bonusBtn.classList.add("golden");
        } else {
          bonusBtn.textContent = bonusData[index];
          bonusBtn.classList.remove("golden");
        }
        bonusBtn.setAttribute("data-index", index);
        bonusBtn.addEventListener("click", function() {
          var sel = document.createElement("select");
          sel.style.fontSize = "16px";
          sel.setAttribute("data-index", index);
          var emptyOpt = document.createElement("option");
          emptyOpt.value = "";
          emptyOpt.textContent = "-----";
          sel.appendChild(emptyOpt);
          for (var i = 1; i <= 5; i++) {
            var opt = document.createElement("option");
            opt.value = i;
            opt.textContent = i;
            sel.appendChild(opt);
          }
          sel.addEventListener("change", function() {
            var idx = sel.getAttribute("data-index");
            bonusData[idx] = sel.value ? sel.value : null;
            setBonusData(bonusData);
            bonusContainer.removeChild(sel);
            bonusBtn.textContent = bonusData[idx] ? bonusData[idx] : "Ø¨Ù„Ø³+";
            if (!bonusData[idx]) {
              bonusBtn.classList.add("golden");
            } else {
              bonusBtn.classList.remove("golden");
            }
            bonusContainer.appendChild(bonusBtn);
          });
          bonusContainer.removeChild(bonusBtn);
          bonusContainer.appendChild(sel);
          sel.focus();
        });
        bonusContainer.appendChild(bonusBtn);
        bonusCell.appendChild(bonusContainer);

        row.appendChild(idCell);
        row.appendChild(nameCell);
        row.appendChild(attendanceCell);
        row.appendChild(bonusCell);
        tableBody.appendChild(row);
      });
      updateCounts();
    }

    // ØªØ¹Ø¯ÙŠÙ„ Ø­Ø³Ø§Ø¨ Ø§Ù„ØºÙŠØ§Ø¨ Ù„ÙŠÙØ­Ø³Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ø°ÙŠÙ† Ù„Ù… ÙŠØ³Ø¬Ù„ Ù„Ù‡Ù… "Ø­Ø¶ÙˆØ±" Ø£Ùˆ "Ù…Ø¬Ø§Ø²"
    function updateCounts() {
      var totalCount = students.length;
      var presentCount = attendanceData.filter(function(s) { return s === "present"; }).length;
      var excusedCount = attendanceData.filter(function(s) { return s === "Ù…Ø¬Ø§Ø²"; }).length;
      // Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ø°ÙŠÙ† Ù‚ÙŠÙ…ØªÙ‡Ù… null Ø£Ùˆ "absent" ÙŠÙØ¹ØªØ¨Ø±ÙˆÙ† ØºØ§Ø¦Ø¨ÙŠÙ†
      var absentCount = attendanceData.filter(function(s) { return s === null || s === "absent"; }).length;
      document.getElementById("totalCount").textContent = totalCount;
      document.getElementById("presentCount").textContent = presentCount;
      document.getElementById("absentCount").textContent = absentCount;
      document.getElementById("excusedCount").textContent = excusedCount;
    }

    document.getElementById("studentsTableBody").addEventListener("click", function(e) {
      if (e.target.tagName.toLowerCase() === "button" && e.target.hasAttribute("data-status")) {
        var index = e.target.getAttribute("data-index");
        var status = e.target.getAttribute("data-status");
        attendanceData[index] = (status === "unset") ? null : status;
        setAttendanceData(attendanceData);
        renderTable();
      }
    });

    document.getElementById("resetAttendanceBtn").addEventListener("click", function() {
      attendanceData = new Array(students.length).fill(null);
      bonusData = new Array(students.length).fill(null);
      setAttendanceData(attendanceData);
      setBonusData(bonusData);
      renderTable();
    });

    document.getElementById("downloadExcelBtn").addEventListener("click", function() {
      downloadExcel();
    });

    function downloadExcel() {
      var subject = document.getElementById("subject").value;
      var section = document.getElementById("sectionSelect").value;
      var date = new Date().toLocaleDateString("en-GB");
      var totalCount = students.length;
      var presentCount = attendanceData.filter(function(s) { return s === "present"; }).length;
      var excusedCount = attendanceData.filter(function(s) { return s === "Ù…Ø¬Ø§Ø²"; }).length;
      var absentCount = attendanceData.filter(function(s) { return s === null || s === "absent"; }).length;
      var wb = XLSX.utils.book_new();
      var headerInfo = [
        ["ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ…:", date],
        ["Ø§Ù„Ù…Ø§Ø¯Ø©:", subject],
        ["Ø§Ù„Ø´Ø¹Ø¨Ø©:", section],
        ["Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„ÙŠ:", totalCount, "Ø§Ù„Ø­Ø¶ÙˆØ±:", presentCount, "Ø§Ù„ØºÙŠØ§Ø¨:", absentCount, "Ø§Ù„Ù…Ø¬Ø§Ø²:", excusedCount],
        [],
        ["ID", "Ø§Ù„Ø§Ø³Ù…", "Ø§Ù„Ø­Ø§Ù„Ø©", "Ø¨Ù„Ø³+"]
      ];
      students.forEach(function(student, index) {
        var attAbbr = "";
        if(attendanceData[index] === "present") attAbbr = "Ø­";
        else if(attendanceData[index] === "absent") attAbbr = "Øº";
        else if(attendanceData[index] === "Ù…Ø¬Ø§Ø²") attAbbr = "Ù…";
        headerInfo.push([
          index + 1,
          student,
          attAbbr,
          bonusData[index] ? bonusData[index] : ""
        ]);
      });
      var ws = XLSX.utils.aoa_to_sheet(headerInfo);
      ws["!cols"] = [{ wch: 7 }, { wch: 25 }, { wch: 10 }, { wch: 8 }];
      ["A1","B1","A2","B2","A3","B3"].forEach(function(cell) {
        if(ws[cell]) ws[cell].s = { font: { sz: 16 } };
      });
      if(ws["B6"]) ws["B6"].s = { font: { sz: 16 } };
      for(var i=0;i<students.length;i++){
        var cellAddress = "B" + (7+i);
        if(ws[cellAddress]) ws[cellAddress].s = { font: { sz: 16 } };
      }
      XLSX.utils.book_append_sheet(wb, ws, "Ø§Ù„Ø­Ø¶ÙˆØ±");
      var fileName = section + "_" + date.replace(/\//g, "-") + ".xlsx";
      XLSX.writeFile(wb, fileName, { cellStyles: true });
    }

    function updateStudentsList() {
      currentSection = document.getElementById("sectionSelect").value;
      students = sections[currentSection];
      attendanceData = getAttendanceData();
      bonusData = getBonusData();
      renderTable();
    }
    document.getElementById("sectionSelect").addEventListener("change", updateStudentsList);
    renderTable();
  </script>
</body>
</html>
